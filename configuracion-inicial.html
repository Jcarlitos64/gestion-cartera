<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraci√≥n Inicial - Cartera de Inversi√≥n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            max-width: 800px;
            width: 100%;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .btn-volver {
            display: inline-block;
            margin-bottom: 20px;
            color: white;
            text-decoration: none;
            font-size: 1.1em;
            opacity: 0.9;
            transition: opacity 0.3s;
        }
        .btn-volver:hover {
            opacity: 1;
            text-decoration: underline;
        }
        .capital-card label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #555;
        }
        .capital-card input {
            width: 100%;
            padding: 15px;
            font-size: 1.5em;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
        }
        .input-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .input-group label {
            flex: 1;
            font-weight: 500;
            color: #555;
        }
        .input-group input {
            width: 200px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            text-align: right;
        }
        .input-group .moneda {
            margin-left: 10px;
            font-weight: 600;
            color: #667eea;
            min-width: 30px;
        }
        .resumen-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            font-size: 1.1em;
        }
        .resumen-item:last-child { border-bottom: none; }
        .resumen-item span:first-child { color: #666; }
        .resumen-item span:last-child { font-weight: 600; color: #333; }
        #mensajeValidacion {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-weight: 500;
            text-align: center;
        }
        .validacion-error { background: #fee; color: #c33; border: 1px solid #fcc; }
        .validacion-success { background: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }
        .validacion-warning { background: #fff3e0; color: #ef6c00; border: 1px solid #ffe0b2; }
        .perfiles-predet {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .btn-perfil {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: all 0.3s;
            flex: 1 1 auto;
            min-width: 120px;
        }
        .btn-perfil:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .perfil-select {
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            min-width: 250px;
            margin-bottom: 15px;
            font-size: 1em;
        }
        .btn-personalizado {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            color: white;
            margin-right: 5px;
        }
        .btn-add { background: #4CAF50; }
        .btn-edit { background: #2196F3; }
        .btn-delete { background: #f44336; }
        .btn-load { background: #9C27B0; }
        #iniciarCartera {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.3s;
            margin-top: 20px;
        }
        #iniciarCartera:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        #iniciarCartera:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: linear-gradient(135deg, #999 0%, #666 100%);
        }
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            text-align: center;
            margin-top: 20px;
        }
        .preview-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .preview-label { display: block; margin-bottom: 8px; color: #666; font-size: 0.9em; }
        .preview-value { display: block; font-size: 1.4em; font-weight: 600; color: #667eea; }
        hr { margin: 20px 0; border: 0; border-top: 1px solid #ddd; }
        
        /* Estilos para el modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
        }
        .modal-content input {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .grid-5 {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .grid-5 input {
            width: 100%;
            padding: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="btn-volver">‚Üê Volver al inicio</a>
        
        <h1>üöÄ Configuraci√≥n Inicial de Cartera</h1>
        
        <div class="card capital-card">
            <label for="capitalTotal">Capital Total (‚Ç¨):</label>
            <input type="number" id="capitalTotal" value="100000" min="0" step="1000">
        </div>

        <div class="card">
            <h2>üìä Distribuye tu capital</h2>
            <div class="input-group">
                <label for="efectivo">üí∂ Efectivo:</label>
                <input type="number" id="efectivo" value="0" min="0" step="100" class="activo-input">
                <span class="moneda">‚Ç¨</span>
            </div>
            <div class="input-group">
                <label for="fondos">üè¶ Fondos:</label>
                <input type="number" id="fondos" value="0" min="0" step="100" class="activo-input">
                <span class="moneda">‚Ç¨</span>
            </div>
            <div class="input-group">
                <label for="etfs">üìà ETFs / Acciones:</label>
                <input type="number" id="etfs" value="0" min="0" step="100" class="activo-input">
                <span class="moneda">‚Ç¨</span>
            </div>
            <div class="input-group">
                <label for="inmobiliario">üè† Inmobiliario:</label>
                <input type="number" id="inmobiliario" value="0" min="0" step="100" class="activo-input">
                <span class="moneda">‚Ç¨</span>
            </div>
        </div>

        <div class="card">
            <h3>üìã Resumen</h3>
            <div class="resumen-item">
                <span>Capital Total:</span>
                <span id="resumenCapital">100,000.00 ‚Ç¨</span>
            </div>
            <div class="resumen-item">
                <span>Total Asignado:</span>
                <span id="totalAsignado">0.00 ‚Ç¨</span>
            </div>
            <div class="resumen-item">
                <span>Diferencia:</span>
                <span id="diferencia">100,000.00 ‚Ç¨</span>
            </div>
            <div id="mensajeValidacion" class="validacion-error">
                ‚ö†Ô∏è Te faltan 100,000.00 ‚Ç¨ por asignar
            </div>
        </div>

        <!-- PERFILES PREDEFINIDOS (5 PERFILES) -->
        <div class="card">
            <h2>üéØ PERFILES PREDEFINIDOS</h2>
            <div class="perfiles-predet">
                <button class="btn-perfil" style="background: #1a237e;" onclick="cargarPerfilPredefinido('ultraconservador')">üõ°Ô∏è UltraConservador</button>
                <button class="btn-perfil" style="background: #283593;" onclick="cargarPerfilPredefinido('conservador')">üõ°Ô∏è Conservador</button>
                <button class="btn-perfil" style="background: #ff8f00;" onclick="cargarPerfilPredefinido('equilibrado')">‚öñÔ∏è Equilibrado</button>
                <button class="btn-perfil" style="background: #e65100;" onclick="cargarPerfilPredefinido('crecimiento')">üìà Crecimiento</button>
                <button class="btn-perfil" style="background: #b71c1c;" onclick="cargarPerfilPredefinido('arriesgado')">üöÄ Arriesgado</button>
            </div>
            <p style="color:#666; font-size:14px; margin-top:10px;">Selecciona un perfil para establecer los porcentajes objetivo de los fondos.</p>
        </div>

        <!-- PERFILES PERSONALIZADOS -->
        <div class="card">
            <h2>üìã PERFILES PERSONALIZADOS</h2>
            <div>
                <select id="selectorPerfil" class="perfil-select"></select>
                <div style="display: flex; gap: 5px; flex-wrap: wrap; margin-top: 10px;">
                    <button class="btn-personalizado btn-add" onclick="nuevoPerfil()">‚ûï Nuevo</button>
                    <button class="btn-personalizado btn-edit" onclick="editarPerfil()">‚úèÔ∏è Editar</button>
                    <button class="btn-personalizado btn-delete" onclick="borrarPerfil()">üóëÔ∏è Borrar</button>
                    <button class="btn-personalizado btn-load" onclick="cargarPerfilPersonalizado()">üì• Cargar</button>
                </div>
            </div>
        </div>

        <!-- PORCENTAJES OBJETIVO -->
        <div class="card">
            <h2>üìä PORCENTAJES OBJETIVO</h2>
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 15px 0;">
                <div><label>Monetario</label><input type="number" id="pctMonetario" value="5" step="0.1" style="width:100%; padding:8px;"></div>
                <div><label>RF Corto</label><input type="number" id="pctRFCorto" value="15" step="0.1" style="width:100%; padding:8px;"></div>
                <div><label>RF Medio</label><input type="number" id="pctRFMedio" value="25" step="0.1" style="width:100%; padding:8px;"></div>
                <div><label>RV</label><input type="number" id="pctRV" value="40" step="0.1" style="width:100%; padding:8px;"></div>
                <div><label>Alternativos</label><input type="number" id="pctAlternativos" value="15" step="0.1" style="width:100%; padding:8px;"></div>
            </div>
            <p id="totalPorcentajes" style="text-align:center; font-weight:bold;">Total: 100%</p>
        </div>

        <!-- BOT√ìN PRINCIPAL -->
        <button id="iniciarCartera" disabled>üîí INICIAR CARTERA</button>

        <!-- VISTA PREVIA -->
        <div class="card">
            <h3>üëÄ Vista previa</h3>
            <div class="preview-grid">
                <div class="preview-item">
                    <span class="preview-label">Fondo</span>
                    <span class="preview-value" id="previewFondo">0.00 ‚Ç¨</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">ETFs/Acc.</span>
                    <span class="preview-value" id="previewEtfs">0.00 ‚Ç¨</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">Efectivo + Inm.</span>
                    <span class="preview-value" id="previewEfectivoInm">0.00 ‚Ç¨</span>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PARA PERFILES PERSONALIZADOS -->
    <div id="modalPerfil" class="modal">
        <div class="modal-content">
            <h3 id="modalTitulo">Nuevo perfil</h3>
            <input type="text" id="modalNombre" placeholder="Nombre del perfil">
            <div class="grid-5">
                <div><label>Mon</label><input type="number" id="modalMon" step="0.1" value="0" oninput="actualizarModalTotal()"></div>
                <div><label>RFC</label><input type="number" id="modalRFC" step="0.1" value="0" oninput="actualizarModalTotal()"></div>
                <div><label>RFM</label><input type="number" id="modalRFM" step="0.1" value="0" oninput="actualizarModalTotal()"></div>
                <div><label>RV</label><input type="number" id="modalRV" step="0.1" value="0" oninput="actualizarModalTotal()"></div>
                <div><label>Alt</label><input type="number" id="modalAlt" step="0.1" value="0" oninput="actualizarModalTotal()"></div>
            </div>
            <p id="modalTotal">Total: 0%</p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn-add" onclick="guardarPerfil()">Guardar</button>
                <button class="btn-delete" onclick="cerrarModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // ==============================================
        // VARIABLES Y FUNCIONES DE UI
        // ==============================================
        const capitalTotal = document.getElementById('capitalTotal');
        const efectivo = document.getElementById('efectivo');
        const fondos = document.getElementById('fondos');
        const etfs = document.getElementById('etfs');
        const inmobiliario = document.getElementById('inmobiliario');
        const resumenCapital = document.getElementById('resumenCapital');
        const totalAsignadoSpan = document.getElementById('totalAsignado');
        const diferenciaSpan = document.getElementById('diferencia');
        const mensajeValidacion = document.getElementById('mensajeValidacion');
        const iniciarCarteraBtn = document.getElementById('iniciarCartera');
        const previewFondo = document.getElementById('previewFondo');
        const previewEtfs = document.getElementById('previewEtfs');
        const previewEfectivoInm = document.getElementById('previewEfectivoInm');
        const activosInputs = [efectivo, fondos, etfs, inmobiliario];

        // Perfiles predefinidos (5)
        const PERFILES_PREDEFINIDOS = {
            ultraconservador: { monetario: 30, rfCorto: 30, rfMedio: 25, rv: 10, alternativos: 5 },
            conservador: { monetario: 20, rfCorto: 25, rfMedio: 25, rv: 20, alternativos: 10 },
            equilibrado: { monetario: 5, rfCorto: 15, rfMedio: 25, rv: 40, alternativos: 15 },
            crecimiento: { monetario: 2, rfCorto: 10, rfMedio: 20, rv: 55, alternativos: 13 },
            arriesgado: { monetario: 0, rfCorto: 5, rfMedio: 15, rv: 70, alternativos: 10 }
        };

        // Perfiles personalizados
        let perfilesPersonalizados = [];
        let editandoIndex = -1;

        function formatearMoneda(valor) {
            return new Intl.NumberFormat('es-ES', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(valor) + ' ‚Ç¨';
        }

        function calcularTotalAsignado() {
            return activosInputs.reduce((total, input) => {
                return total + (parseFloat(input.value) || 0);
            }, 0);
        }

        function guardarCartera() {
            const carteraData = {
                capitalTotal: parseFloat(capitalTotal.value) || 0,
                efectivo: parseFloat(efectivo.value) || 0,
                fondos: parseFloat(fondos.value) || 0,
                etfs: parseFloat(etfs.value) || 0,
                inmobiliario: parseFloat(inmobiliario.value) || 0,
                porcentajes: {
                    monetario: parseFloat(document.getElementById('pctMonetario').value) || 0,
                    rfCorto: parseFloat(document.getElementById('pctRFCorto').value) || 0,
                    rfMedio: parseFloat(document.getElementById('pctRFMedio').value) || 0,
                    rv: parseFloat(document.getElementById('pctRV').value) || 0,
                    alternativos: parseFloat(document.getElementById('pctAlternativos').value) || 0
                },
                fechaCreacion: new Date().toISOString()
            };
            localStorage.setItem('carteraConfigurada', 'true');
            localStorage.setItem('carteraData', JSON.stringify(carteraData));
            
            // Guardar porcentajes por separado para cartera.html
            localStorage.setItem('pctMonetario', carteraData.porcentajes.monetario);
            localStorage.setItem('pctRFCorto', carteraData.porcentajes.rfCorto);
            localStorage.setItem('pctRFMedio', carteraData.porcentajes.rfMedio);
            localStorage.setItem('pctRV', carteraData.porcentajes.rv);
            localStorage.setItem('pctAlternativos', carteraData.porcentajes.alternativos);
        }

        function actualizarUI() {
            const capital = parseFloat(capitalTotal.value) || 0;
            const totalAsignado = calcularTotalAsignado();
            const diferencia = capital - totalAsignado;

            resumenCapital.textContent = formatearMoneda(capital);
            totalAsignadoSpan.textContent = formatearMoneda(totalAsignado);
            diferenciaSpan.textContent = formatearMoneda(Math.abs(diferencia));
            previewFondo.textContent = formatearMoneda(parseFloat(fondos.value) || 0);
            previewEtfs.textContent = formatearMoneda(parseFloat(etfs.value) || 0);
            
            const efectivoInm = (parseFloat(efectivo.value) || 0) + (parseFloat(inmobiliario.value) || 0);
            previewEfectivoInm.textContent = formatearMoneda(efectivoInm);

            // Validar porcentajes
            let p1 = parseFloat(document.getElementById('pctMonetario').value) || 0;
            let p2 = parseFloat(document.getElementById('pctRFCorto').value) || 0;
            let p3 = parseFloat(document.getElementById('pctRFMedio').value) || 0;
            let p4 = parseFloat(document.getElementById('pctRV').value) || 0;
            let p5 = parseFloat(document.getElementById('pctAlternativos').value) || 0;
            let totalPct = p1 + p2 + p3 + p4 + p5;
            document.getElementById('totalPorcentajes').innerText = `Total: ${totalPct.toFixed(1)}%`;
            
            let porcentajesOk = Math.abs(totalPct - 100) < 0.01;

            if (Math.abs(diferencia) < 0.01 && porcentajesOk) {
                mensajeValidacion.textContent = '‚úÖ Todo correcto. Puedes iniciar la cartera';
                mensajeValidacion.className = 'validacion-success';
                iniciarCarteraBtn.disabled = false;
                iniciarCarteraBtn.innerHTML = 'üöÄ INICIAR CARTERA';
            } else if (!porcentajesOk) {
                mensajeValidacion.textContent = `‚ö†Ô∏è Los porcentajes deben sumar 100% (actual: ${totalPct.toFixed(1)}%)`;
                mensajeValidacion.className = 'validacion-warning';
                iniciarCarteraBtn.disabled = true;
                iniciarCarteraBtn.innerHTML = 'üîí INICIAR CARTERA';
            } else if (diferencia > 0) {
                mensajeValidacion.textContent = `‚ö†Ô∏è Te faltan ${formatearMoneda(diferencia)} por asignar`;
                mensajeValidacion.className = 'validacion-warning';
                iniciarCarteraBtn.disabled = true;
                iniciarCarteraBtn.innerHTML = 'üîí INICIAR CARTERA';
            } else if (diferencia < 0) {
                mensajeValidacion.textContent = `‚ùå Te pasaste por ${formatearMoneda(Math.abs(diferencia))}. Reduce alguna partida`;
                mensajeValidacion.className = 'validacion-error';
                iniciarCarteraBtn.disabled = true;
                iniciarCarteraBtn.innerHTML = 'üîí INICIAR CARTERA';
            }
        }

        function cargarPerfilPredefinido(perfil) {
            let p = PERFILES_PREDEFINIDOS[perfil];
            document.getElementById('pctMonetario').value = p.monetario;
            document.getElementById('pctRFCorto').value = p.rfCorto;
            document.getElementById('pctRFMedio').value = p.rfMedio;
            document.getElementById('pctRV').value = p.rv;
            document.getElementById('pctAlternativos').value = p.alternativos;
            actualizarUI();
        }

        // ==============================================
        // PERFILES PERSONALIZADOS
        // ==============================================
        function cargarPerfilesGuardados() {
            let guardados = localStorage.getItem('perfilesPersonalizados');
            perfilesPersonalizados = guardados ? JSON.parse(guardados) : [];
            actualizarSelectorPerfil();
        }

        function guardarPerfiles() {
            localStorage.setItem('perfilesPersonalizados', JSON.stringify(perfilesPersonalizados));
        }

        function actualizarSelectorPerfil() {
            let select = document.getElementById('selectorPerfil');
            if (!select) return;
            select.innerHTML = '<option value="">-- Selecciona un perfil --</option>';
            perfilesPersonalizados.forEach((p, index) => {
                let opt = document.createElement('option');
                opt.value = index;
                opt.text = p.nombre;
                select.appendChild(opt);
            });
        }

        function nuevoPerfil() {
            editandoIndex = -1;
            document.getElementById('modalTitulo').innerText = 'Nuevo perfil';
            document.getElementById('modalNombre').value = '';
            document.getElementById('modalMon').value = 0;
            document.getElementById('modalRFC').value = 0;
            document.getElementById('modalRFM').value = 0;
            document.getElementById('modalRV').value = 0;
            document.getElementById('modalAlt').value = 0;
            actualizarModalTotal();
            document.getElementById('modalPerfil').style.display = 'flex';
        }

        function editarPerfil() {
            let select = document.getElementById('selectorPerfil');
            let idx = select.value;
            if (idx === '') { alert('Selecciona un perfil'); return; }
            let p = perfilesPersonalizados[idx];
            editandoIndex = parseInt(idx);
            document.getElementById('modalTitulo').innerText = 'Editar perfil';
            document.getElementById('modalNombre').value = p.nombre;
            document.getElementById('modalMon').value = p.monetario;
            document.getElementById('modalRFC').value = p.rfCorto;
            document.getElementById('modalRFM').value = p.rfMedio;
            document.getElementById('modalRV').value = p.rv;
            document.getElementById('modalAlt').value = p.alternativos;
            actualizarModalTotal();
            document.getElementById('modalPerfil').style.display = 'flex';
        }

        function borrarPerfil() {
            let select = document.getElementById('selectorPerfil');
            let idx = select.value;
            if (idx === '') { alert('Selecciona un perfil'); return; }
            if (!confirm('¬øBorrar este perfil?')) return;
            perfilesPersonalizados.splice(idx, 1);
            guardarPerfiles();
            actualizarSelectorPerfil();
        }

        function cargarPerfilPersonalizado() {
            let select = document.getElementById('selectorPerfil');
            let idx = select.value;
            if (idx === '') { alert('Selecciona un perfil'); return; }
            let p = perfilesPersonalizados[idx];
            document.getElementById('pctMonetario').value = p.monetario;
            document.getElementById('pctRFCorto').value = p.rfCorto;
            document.getElementById('pctRFMedio').value = p.rfMedio;
            document.getElementById('pctRV').value = p.rv;
            document.getElementById('pctAlternativos').value = p.alternativos;
            actualizarUI();
        }

        function actualizarModalTotal() {
            let m = parseFloat(document.getElementById('modalMon').value) || 0;
            let rfc = parseFloat(document.getElementById('modalRFC').value) || 0;
            let rfm = parseFloat(document.getElementById('modalRFM').value) || 0;
            let rv = parseFloat(document.getElementById('modalRV').value) || 0;
            let alt = parseFloat(document.getElementById('modalAlt').value) || 0;
            document.getElementById('modalTotal').innerText = 'Total: ' + (m + rfc + rfm + rv + alt).toFixed(1) + '%';
        }

        function guardarPerfil() {
            let nombre = document.getElementById('modalNombre').value.trim();
            if (!nombre) { alert('El nombre es obligatorio'); return; }
            let m = parseFloat(document.getElementById('modalMon').value) || 0;
            let rfc = parseFloat(document.getElementById('modalRFC').value) || 0;
            let rfm = parseFloat(document.getElementById('modalRFM').value) || 0;
            let rv = parseFloat(document.getElementById('modalRV').value) || 0;
            let alt = parseFloat(document.getElementById('modalAlt').value) || 0;
            let total = m + rfc + rfm + rv + alt;
            
            if (Math.abs(total - 100) > 0.01) {
                alert('Los porcentajes deben sumar 100%. Actual: ' + total.toFixed(1) + '%');
                return;
            }
            
            let nuevo = { nombre, monetario: m, rfCorto: rfc, rfMedio: rfm, rv, alternativos: alt };
            
            if (editandoIndex === -1) {
                perfilesPersonalizados.push(nuevo);
            } else {
                perfilesPersonalizados[editandoIndex] = nuevo;
            }
            
            guardarPerfiles();
            actualizarSelectorPerfil();
            cerrarModal();
        }

        function cerrarModal() {
            document.getElementById('modalPerfil').style.display = 'none';
        }

        // ==============================================
        // EVENT LISTENERS
        // ==============================================
        capitalTotal.addEventListener('input', actualizarUI);
        activosInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                if (this.value < 0) this.value = 0;
                actualizarUI();
            });
        });

        document.getElementById('pctMonetario').addEventListener('input', actualizarUI);
        document.getElementById('pctRFCorto').addEventListener('input', actualizarUI);
        document.getElementById('pctRFMedio').addEventListener('input', actualizarUI);
        document.getElementById('pctRV').addEventListener('input', actualizarUI);
        document.getElementById('pctAlternativos').addEventListener('input', actualizarUI);

        iniciarCarteraBtn.addEventListener('click', function() {
            if (!iniciarCarteraBtn.disabled) {
                guardarCartera();
                alert('‚úÖ ¬°Cartera configurada correctamente! Redirigiendo al dashboard...');
                window.location.href = 'dashboard.html';
            }
        });

        // ==============================================
        // INICIALIZACI√ìN
        // ==============================================
        window.addEventListener('load', function() {
            cargarPerfilesGuardados();
            
            if (localStorage.getItem('carteraConfigurada') === 'true') {
                if (confirm('Ya tienes una cartera configurada. ¬øQuieres cargar los datos existentes?')) {
                    const carteraData = JSON.parse(localStorage.getItem('carteraData'));
                    if (carteraData) {
                        capitalTotal.value = carteraData.capitalTotal;
                        efectivo.value = carteraData.efectivo;
                        fondos.value = carteraData.fondos;
                        etfs.value = carteraData.etfs;
                        inmobiliario.value = carteraData.inmobiliario;
                        
                        if (carteraData.porcentajes) {
                            document.getElementById('pctMonetario').value = carteraData.porcentajes.monetario || 5;
                            document.getElementById('pctRFCorto').value = carteraData.porcentajes.rfCorto || 15;
                            document.getElementById('pctRFMedio').value = carteraData.porcentajes.rfMedio || 25;
                            document.getElementById('pctRV').value = carteraData.porcentajes.rv || 40;
                            document.getElementById('pctAlternativos').value = carteraData.porcentajes.alternativos || 15;
                        }
                    }
                }
            }
            actualizarUI();
        });
    </script>
</body>
</html>